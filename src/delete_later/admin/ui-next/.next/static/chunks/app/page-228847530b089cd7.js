(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{67:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eb});var s=a(5155),r=a(2115),n=a(5695);let l=e=>{let{children:t}=e,a=(0,n.useRouter)(),[l,i]=(0,r.useState)(null);return((0,r.useEffect)(()=>{localStorage.getItem("adminToken")?i(!0):(console.log("AuthWrapper: No token found, redirecting to login."),a.push("/login"))},[a]),null===l)?null:(0,s.jsx)(s.Fragment,{children:t})};var i=a(285);let o=()=>{let e=(0,n.useRouter)();return(0,s.jsxs)("header",{className:"flex items-center justify-between p-4 border-b bg-background",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Admin Dashboard"}),(0,s.jsx)(i.$,{variant:"outline",onClick:()=>{localStorage.removeItem("adminToken"),console.log("Admin token removed."),e.push("/login")},children:"Logout"})]})};var d=a(4338),c=a(6474),u=a(5196),h=a(7863),x=a(9434);function g(e){let{...t}=e;return(0,s.jsx)(d.bL,{"data-slot":"select",...t})}function f(e){let{...t}=e;return(0,s.jsx)(d.WT,{"data-slot":"select-value",...t})}function m(e){let{className:t,size:a="default",children:r,...n}=e;return(0,s.jsxs)(d.l9,{"data-slot":"select-trigger","data-size":a,className:(0,x.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[r,(0,s.jsx)(d.In,{asChild:!0,children:(0,s.jsx)(c.A,{className:"size-4 opacity-50"})})]})}function p(e){let{className:t,children:a,position:r="popper",...n}=e;return(0,s.jsx)(d.ZL,{children:(0,s.jsxs)(d.UC,{"data-slot":"select-content",className:(0,x.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...n,children:[(0,s.jsx)(b,{}),(0,s.jsx)(d.LM,{className:(0,x.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,s.jsx)(j,{})]})})}function v(e){let{className:t,children:a,...r}=e;return(0,s.jsxs)(d.q7,{"data-slot":"select-item",className:(0,x.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...r,children:[(0,s.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,s.jsx)(d.VF,{children:(0,s.jsx)(u.A,{className:"size-4"})})}),(0,s.jsx)(d.p4,{children:a})]})}function b(e){let{className:t,...a}=e;return(0,s.jsx)(d.PP,{"data-slot":"select-scroll-up-button",className:(0,x.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(h.A,{className:"size-4"})})}function j(e){let{className:t,...a}=e;return(0,s.jsx)(d.wn,{"data-slot":"select-scroll-down-button",className:(0,x.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(c.A,{className:"size-4"})})}var y=a(5731);function w(e){let{onSiteSelected:t,refreshCounter:a}=e,[n,l]=(0,r.useState)([]),[i,o]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{c(!0),h(null);try{let e=await (0,y.t)("/admin/api/config/sites");if(!e||"object"!=typeof e||!e.success||!Array.isArray(e.data))throw console.error("Invalid response format received:",e),Error("Invalid response format from API");let t=(e.data||[]).map(e=>({id:e,name:e}));l(t)}catch(e){console.error("Failed to fetch sites:",e),h(e instanceof Error?e.message:"Failed to load sites."),l([])}finally{c(!1)}})()},[a]),d)?(0,s.jsx)("p",{children:"Loading sites..."}):u?(0,s.jsxs)("p",{className:"text-red-500",children:["Error loading sites: ",u]}):(0,s.jsxs)(g,{onValueChange:e=>{let a="none"===e?null:e;o(a),t(a)},value:null!=i?i:"none",children:[(0,s.jsx)(m,{className:"w-[280px]",children:(0,s.jsx)(f,{placeholder:"Select a site"})}),(0,s.jsxs)(p,{children:[(0,s.jsx)(v,{value:"none",children:"-- Select a Site --"}),n.length>0?n.map(e=>(0,s.jsxs)(v,{value:e.id,children:[e.name," "]},e.id)):(0,s.jsx)(v,{value:"no-sites",disabled:!0,children:"No sites found"})]})]})}var k=a(5452),N=a(4416);function S(e){let{...t}=e;return(0,s.jsx)(k.bL,{"data-slot":"dialog",...t})}function C(e){let{...t}=e;return(0,s.jsx)(k.ZL,{"data-slot":"dialog-portal",...t})}function E(e){let{...t}=e;return(0,s.jsx)(k.bm,{"data-slot":"dialog-close",...t})}function T(e){let{className:t,...a}=e;return(0,s.jsx)(k.hJ,{"data-slot":"dialog-overlay",className:(0,x.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function V(e){let{className:t,children:a,...r}=e;return(0,s.jsxs)(C,{"data-slot":"dialog-portal",children:[(0,s.jsx)(T,{}),(0,s.jsxs)(k.UC,{"data-slot":"dialog-content",className:(0,x.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[a,(0,s.jsxs)(k.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(N.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function K(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,x.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function z(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:(0,x.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function A(e){let{className:t,...a}=e;return(0,s.jsx)(k.hE,{"data-slot":"dialog-title",className:(0,x.cn)("text-lg leading-none font-semibold",t),...a})}function I(e){let{className:t,...a}=e;return(0,s.jsx)(k.VY,{"data-slot":"dialog-description",className:(0,x.cn)("text-muted-foreground text-sm",t),...a})}var D=a(2523),F=a(5057);function R(e){let{className:t,...a}=e;return(0,s.jsx)("textarea",{"data-slot":"textarea",className:(0,x.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}var _=a(6671);function O(e){let{siteId:t,open:a,onOpenChange:n,onSuccess:l}=e,[o,d]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[h,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a&&(d(""),u(""),x(!1))},[a,t]);let g=async()=>{if(!o.trim()||!c.trim())return void _.oR.error("Both Key and Value are required.");x(!0);try{await (0,y.t)("/admin/api/kv/".concat(t,"/").concat(encodeURIComponent(o.trim())),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:c})}),_.oR.success("KV pair added successfully!"),l(),n(!1)}catch(t){console.error("Failed to add KV pair:",t);let e=t instanceof Error?t.message:"An unexpected error occurred.";_.oR.error("Failed to add KV pair",{description:e})}finally{x(!1)}},f=e=>{n(e)};return(0,s.jsx)(S,{open:a,onOpenChange:f,children:(0,s.jsxs)(V,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(K,{children:[(0,s.jsx)(A,{children:"Add New KV Pair"}),(0,s.jsxs)(I,{children:["Enter the key and value for the new pair for site: ",t]})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(F.J,{htmlFor:"kv-key",className:"text-right",children:"Key"}),(0,s.jsx)(D.p,{id:"kv-key",value:o,onChange:e=>d(e.target.value),className:"col-span-3",placeholder:"e.g., feature_flag",disabled:h})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[" ",(0,s.jsxs)(F.J,{htmlFor:"kv-value",className:"text-right pt-2",children:[" ","Value"]}),(0,s.jsx)(R,{id:"kv-value",value:c,onChange:e=>u(e.target.value),className:"col-span-3",placeholder:"Enter value (string, JSON, etc.)",disabled:h,rows:4})]})]}),(0,s.jsxs)(z,{children:[(0,s.jsx)(i.$,{variant:"outline",onClick:()=>f(!1),disabled:h,children:"Cancel"}),(0,s.jsx)(i.$,{onClick:g,disabled:h||!o.trim()||!c.trim(),children:h?"Adding...":"Add Pair"})]})]})})}function P(e){var t,a;let{siteId:n,kvPair:l,open:o,onOpenChange:d,onSuccess:c}=e,[u,h]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(o&&l){let e="";if(null!==l.value&&void 0!==l.value)if("string"==typeof l.value)e=l.value;else if("object"==typeof l.value)try{e=JSON.stringify(l.value,null,2)}catch(t){e=String(l.value)}else e=String(l.value);h(e),g(!1)}else o||(h(""),g(!1))},[o,l]);let f=async()=>{if(!l)return void _.oR.error("No KV pair selected for editing.");if(!u.trim())return void _.oR.error("Value cannot be empty.");g(!0);try{await (0,y.t)("/admin/api/kv/".concat(encodeURIComponent(l.key)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:u})}),_.oR.success("KV pair updated successfully!"),c({key:l.key,value:u}),d(!1)}catch(t){console.error("Failed to update KV pair:",t);let e=t instanceof Error?t.message:"An unexpected error occurred.";_.oR.error("Failed to update KV pair",{description:e})}finally{g(!1)}},m=e=>{d(e)};return(0,s.jsx)(S,{open:o,onOpenChange:m,children:(0,s.jsxs)(V,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(K,{children:[(0,s.jsx)(A,{children:"Edit KV Pair"}),(0,s.jsxs)(I,{children:["Modify the value for key: ",(0,s.jsx)("span",{className:"font-mono bg-muted px-1 rounded",children:null!=(t=null==l?void 0:l.key)?t:"N/A"})," on site: ",n," "]})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(F.J,{htmlFor:"kv-key-edit",className:"text-right",children:"Key"}),(0,s.jsx)(D.p,{id:"kv-key-edit",value:null!=(a=null==l?void 0:l.key)?a:"",className:"col-span-3",readOnly:!0,disabled:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,s.jsx)(F.J,{htmlFor:"kv-value-edit",className:"text-right pt-2",children:"Value"}),(0,s.jsx)(R,{id:"kv-value-edit",value:u,onChange:e=>h(e.target.value),className:"col-span-3",placeholder:"Enter new value",disabled:x,rows:6})]})]}),(0,s.jsxs)(z,{children:[(0,s.jsx)(i.$,{variant:"outline",onClick:()=>m(!1),disabled:x,children:"Cancel"}),(0,s.jsx)(i.$,{onClick:f,disabled:x||!u.trim(),children:x?"Saving...":"Save Changes"})]})]})})}function L(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,s.jsx)("table",{"data-slot":"table",className:(0,x.cn)("w-full caption-bottom text-sm",t),...a})})}function U(e){let{className:t,...a}=e;return(0,s.jsx)("thead",{"data-slot":"table-header",className:(0,x.cn)("[&_tr]:border-b",t),...a})}function $(e){let{className:t,...a}=e;return(0,s.jsx)("tbody",{"data-slot":"table-body",className:(0,x.cn)("[&_tr:last-child]:border-0",t),...a})}function J(e){let{className:t,...a}=e;return(0,s.jsx)("tr",{"data-slot":"table-row",className:(0,x.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function H(e){let{className:t,...a}=e;return(0,s.jsx)("th",{"data-slot":"table-head",className:(0,x.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function M(e){let{className:t,...a}=e;return(0,s.jsx)("td",{"data-slot":"table-cell",className:(0,x.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}var Z=a(6981);function q(e){let{className:t,...a}=e;return(0,s.jsx)(Z.bL,{"data-slot":"checkbox",className:(0,x.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(Z.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,s.jsx)(u.A,{className:"size-3.5"})})})}let Y=(0,a(2085).F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function B(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,x.cn)(Y({variant:a}),t),...r})}function G(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,x.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function W(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,x.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}var Q=a(1684),X=a(7649);function ee(e){let{...t}=e;return(0,s.jsx)(X.bL,{"data-slot":"alert-dialog",...t})}function et(e){let{...t}=e;return(0,s.jsx)(X.l9,{"data-slot":"alert-dialog-trigger",...t})}function ea(e){let{...t}=e;return(0,s.jsx)(X.ZL,{"data-slot":"alert-dialog-portal",...t})}function es(e){let{className:t,...a}=e;return(0,s.jsx)(X.hJ,{"data-slot":"alert-dialog-overlay",className:(0,x.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function er(e){let{className:t,...a}=e;return(0,s.jsxs)(ea,{children:[(0,s.jsx)(es,{}),(0,s.jsx)(X.UC,{"data-slot":"alert-dialog-content",className:(0,x.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function en(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,x.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function el(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,x.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function ei(e){let{className:t,...a}=e;return(0,s.jsx)(X.hE,{"data-slot":"alert-dialog-title",className:(0,x.cn)("text-lg font-semibold",t),...a})}function eo(e){let{className:t,...a}=e;return(0,s.jsx)(X.VY,{"data-slot":"alert-dialog-description",className:(0,x.cn)("text-muted-foreground text-sm",t),...a})}function ed(e){let{className:t,...a}=e;return(0,s.jsx)(X.rc,{className:(0,x.cn)((0,i.r)(),t),...a})}function ec(e){let{className:t,...a}=e;return(0,s.jsx)(X.ZD,{className:(0,x.cn)((0,i.r)({variant:"outline"}),t),...a})}function eu(e){let{selectedSiteId:t,filterText:a,statusFilter:n,onEditSuccess:l,onDeleteSuccess:o,onSelectionChange:d}=e,[c,u]=(0,r.useState)([]),[h,x]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null),[m,p]=(0,r.useState)(new Set),v=(0,r.useRef)(0),[b,j]=(0,r.useState)(!1),[w,k]=(0,r.useState)(null),[N,S]=(0,r.useState)(null),[C,E]=(0,r.useState)(!1),[T,V]=(0,r.useState)(null),[K,z]=(0,r.useState)(!1),A=(0,r.useCallback)(async()=>{if(console.log("[KVTable] fetchKVData triggered. Site:",t,"Search:",a,"Status:",n),!t&&!n){console.log("[KVTable] No site selected and no status filter active, clearing data."),u([]),p(new Set),d(new Set);return}x(!0),f(null);try{let e=Date.now(),s="/admin/api/kv-keys?_=".concat(e);t?s+="&siteId=".concat(t):n&&(s+="&status=".concat(encodeURIComponent(n))),a&&(s+="&search=".concat(encodeURIComponent(a))),console.log("[KVTable] Fetching data from URL:",s);let r=await (0,y.t)(s,{cache:"no-store"});console.log("[KVTable] Raw response received:",r);let l=[];if(Array.isArray(r))l=r;else if("object"==typeof r&&null!==r&&"data"in r)l=Array.isArray(r.data)?r.data:[r.data];else throw console.error("[KVTable] Invalid response format:",r),Error("Invalid response format when fetching KV data. Expected array or {data: array}");let i=l.map(e=>({key:e.name||e.key||"unknown_key",value:e.value}));console.log("[KVTable] Setting KV data:",i),u(i),p(new Set),d(new Set)}catch(e){if(console.error("[KVTable] Failed to fetch KV data for site ".concat(t," / status ").concat(n,":"),e),e instanceof Error){if(e.message.includes("404")){console.log("[KVTable] 404 response - treating as empty data"),u([]),p(new Set),d(new Set),f(null);return}if(e.message.includes("410")){console.log("[KVTable] 410 response - data was deleted"),u([]),p(new Set),d(new Set),f("Data was deleted");return}}if(v.current<3){v.current++,f("Retry attempt ".concat(v.current,"/").concat(3,": Retrying fetch in 2 seconds..."));let e=setTimeout(()=>{A()},2e3);return()=>clearTimeout(e)}v.current=0,f(e instanceof Error?"Failed after ".concat(3," retries: ").concat(e.message):"Failed to load KV data after ".concat(3," retries.")),u([]),p(new Set),d(new Set)}finally{x(!1)}},[t,a,n,d]);(0,r.useEffect)(()=>{console.log("[KVTable] useEffect triggered with dependencies: SiteId=".concat(t,", Filter=").concat(a,", Status=").concat(n));let e=new AbortController,s=!0,r=async()=>{s&&(h?console.log("[KVTable] Skipping fetch: Data is already loading."):await A())};return t||n?r():console.log("[KVTable] Skipping fetch: No siteId or status filter selected."),()=>{s=!1,e.abort()}},[t,a,n,A,h]);let I=(e,t)=>{let a=new Set(m);t?a.add(e):a.delete(e),p(a),d(a)},D=(0,r.useMemo)(()=>{if(0===c.length||0===m.size)return!1;if(m.size===c.length){let e=!0;for(let t of c)if(!m.has(t.key)){e=!1;break}if(e)return!0}let e=!1;for(let t of c)if(m.has(t.key)){e=!0;break}return!!e&&"indeterminate"},[m,c]),F=e=>{k(e),j(!0)},R=e=>{S(e),V(null)},_=async()=>{if(N){E(!0),V(null);try{if(!t){console.error("[KVTable] Delete aborted: No siteId selected."),V("Cannot delete KV pair without a selected site ID."),E(!1);return}await (0,y.t)("/admin/api/kv?siteId=".concat(t,"&key=").concat(encodeURIComponent(N)),{method:"DELETE"}),S(null),o()}catch(e){console.error("Failed to delete KV pair:",e),V(e instanceof Error?e.message:"Failed to delete item.")}finally{E(!1)}}};return h?(0,s.jsx)("p",{children:"Loading KV data..."}):g?(0,s.jsxs)(B,{variant:"destructive",children:[(0,s.jsx)(Q.A,{className:"h-4 w-4"}),(0,s.jsx)(G,{children:"Error Loading KV Data"}),(0,s.jsx)(W,{children:g})]}):t||n?0!==c.length||h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"border rounded-md",children:(0,s.jsxs)(L,{children:[(0,s.jsx)(U,{children:(0,s.jsxs)(J,{children:[(0,s.jsx)(H,{className:"w-[50px]",children:(0,s.jsx)(q,{checked:D,onCheckedChange:e=>{let t=new Set;!0===e&&c.forEach(e=>t.add(e.key)),p(t),d(t)},"aria-label":"Select all rows",disabled:0===c.length})}),(0,s.jsx)(H,{children:"Key"}),(0,s.jsx)(H,{children:"Value"}),(0,s.jsx)(H,{className:"text-right w-[150px]",children:"Actions"})]})}),(0,s.jsx)($,{children:c.map(e=>(0,s.jsx)(J,{"data-state":m.has(e.key)?"selected":void 0,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M,{children:(0,s.jsx)(q,{checked:m.has(e.key),onCheckedChange:t=>I(e.key,!!t),"aria-label":"Select row ".concat(e.key)})}),(0,s.jsx)(M,{className:"font-medium",children:e.key}),(0,s.jsx)(M,{children:"string"==typeof e.value&&e.value.length>100?"".concat(e.value.substring(0,100),"..."):String(e.value)}),(0,s.jsxs)(M,{className:"text-right space-x-2",children:[(0,s.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>F(e),disabled:!t,children:"Edit"}),(0,s.jsx)(ee,{children:(0,s.jsx)(et,{asChild:!0,children:(0,s.jsx)(i.$,{variant:"destructive",size:"sm",onClick:()=>R(e.key),disabled:!t,children:"Delete"})})})]})]})},e.key))})]})}),(0,s.jsx)(P,{open:b,onOpenChange:j,kvPair:w,siteId:null!=t?t:"",onSuccess:e=>{u(t=>t.map(t=>t.key===e.key?{...t,value:e.value}:t)),l(),k(null)}}),(0,s.jsx)(ee,{open:!!N,onOpenChange:e=>!e&&S(null),children:(0,s.jsxs)(er,{children:[(0,s.jsxs)(en,{children:[(0,s.jsx)(ei,{children:"Are you absolutely sure?"}),(0,s.jsxs)(eo,{children:["This action cannot be undone. This will permanently delete the KV pair with key: ",(0,s.jsx)("span",{className:"font-semibold",children:N}),"."]})]}),T&&(0,s.jsxs)(B,{variant:"destructive",children:[(0,s.jsx)(Q.A,{className:"h-4 w-4"}),(0,s.jsx)(G,{children:"Delete Error"}),(0,s.jsx)(W,{children:T})]}),(0,s.jsxs)(el,{children:[(0,s.jsx)(ec,{disabled:C,onClick:()=>S(null),children:"Cancel"}),(0,s.jsx)(ed,{onClick:_,disabled:C,children:C?"Deleting...":"Continue"})]})]})}),(0,s.jsx)(O,{siteId:null!=t?t:"",open:K,onOpenChange:z,onSuccess:l})]}):(0,s.jsxs)(B,{children:[(0,s.jsx)(Q.A,{className:"h-4 w-4"}),(0,s.jsx)(G,{children:"No KV Data Found"}),(0,s.jsxs)(W,{children:["No KV pairs found",a?" matching your text filter":"",n?" matching status '".concat(n,"'"):"",t?" for site ".concat(t):"","."]})]}):(0,s.jsx)("p",{children:"Please select a site or a status filter to view KV data."})}function eh(e){let{open:t,onOpenChange:a,onSuccess:n}=e,[l,o]=(0,r.useState)(""),[d,c]=(0,r.useState)(!1),u=async()=>{if(!l.trim())return void _.oR.error("Site ID cannot be empty.");c(!0);try{let e=l.trim(),t=await (0,y.t)("/admin/api/kv/create-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:e})});console.log("Site created successfully:",t),_.oR.success("Site created successfully!"),o(""),n(),a(!1)}catch(t){console.error("Failed to create site:",t);let e=t instanceof Error?t.message:"An unexpected error occurred.";_.oR.error("Failed to create site",{description:e})}finally{c(!1)}},h=e=>{e||(o(""),c(!1)),a(e)};return(0,s.jsx)(S,{open:t,onOpenChange:h,children:(0,s.jsxs)(V,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(K,{children:[(0,s.jsx)(A,{children:"Create New Site"}),(0,s.jsx)(I,{children:"Enter a unique ID for the new site. This ID will be used in configurations and URLs."})]}),(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(F.J,{htmlFor:"site-id",className:"text-right",children:"Site ID"}),(0,s.jsx)(D.p,{id:"site-id",value:l,onChange:e=>o(e.target.value),className:"col-span-3",placeholder:"e.g., my-new-site",disabled:d})]})}),(0,s.jsxs)(z,{children:[(0,s.jsx)(i.$,{variant:"outline",onClick:()=>h(!1),disabled:d,children:"Cancel"}),(0,s.jsx)(i.$,{onClick:u,disabled:d||!l.trim(),children:d?"Creating...":"Create Site"})]})]})})}var ex=a(7655);function eg(e){let{className:t,children:a,...r}=e;return(0,s.jsxs)(ex.bL,{"data-slot":"scroll-area",className:(0,x.cn)("relative",t),...r,children:[(0,s.jsx)(ex.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,s.jsx)(ef,{}),(0,s.jsx)(ex.OK,{})]})}function ef(e){let{className:t,orientation:a="vertical",...r}=e;return(0,s.jsx)(ex.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,x.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...r,children:(0,s.jsx)(ex.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var em=a(1154);function ep(e){let{open:t,onOpenChange:a,siteId:n,keysToDelete:l,onSuccess:o}=e,[d,c]=(0,r.useState)(!1),u=async()=>{if(!n||0===l.size)return void _.oR.error("No site selected or no keys to delete.");c(!0);try{await (0,y.t)("/admin/api/kv/bulk-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:Array.from(l)})}),_.oR.success("Successfully deleted ".concat(l.size," KV pair(s).")),o(),a(!1)}catch(t){console.error("Error deleting KV pairs:",t);let e="An unexpected error occurred while deleting KV pairs.";t instanceof Error&&(e=t.message),_.oR.error("Failed to delete KV pairs",{description:e})}finally{c(!1)}};return(0,s.jsx)(S,{open:t,onOpenChange:e=>{e||c(!1),a(e)},children:(0,s.jsxs)(V,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(K,{children:[(0,s.jsx)(A,{children:"Confirm Deletion"}),(0,s.jsxs)(I,{children:["Are you sure you want to delete the following ",l.size," KV pair(s) from site ",(0,s.jsx)("span",{className:"font-semibold",children:null!=n?n:"N/A"}),"? This action cannot be undone."]})]}),l.size>0&&(0,s.jsx)(eg,{className:"h-[100px] w-full rounded-md border p-4 my-2",children:(0,s.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:Array.from(l).map(e=>(0,s.jsx)("li",{className:"font-mono text-sm",children:e},e))})}),(0,s.jsxs)(z,{children:[(0,s.jsx)(E,{asChild:!0,children:(0,s.jsx)(i.$,{variant:"outline",disabled:d,children:"Cancel"})}),(0,s.jsxs)(i.$,{variant:"destructive",onClick:u,disabled:d||!n||0===l.size,children:[d?(0,s.jsx)(em.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete ",l.size," Item(s)"]})]})]})})}function ev(e){let{open:t,onOpenChange:a,siteId:n,onSuccess:l}=e,[i,o]=(0,r.useState)(!1),d=async()=>{if(!n)return void _.oR.error("No site selected for deletion.");o(!0);try{console.log("[DeleteSiteDialog] Attempting to delete site: ".concat(n)),await (0,y.t)("/admin/api/sites/".concat(n),{method:"DELETE"}),console.log("[DeleteSiteDialog] Site deletion successful for: ".concat(n)),_.oR.success('Site "'.concat(n,'" and all its KV data have been deleted.')),l(),a(!1)}catch(t){console.error("[DeleteSiteDialog] Error deleting site ".concat(n,":"),t);let e="Failed to delete site.";t instanceof Error&&(e=t.message),_.oR.error(e)}finally{o(!1)}};return(0,s.jsx)(ee,{open:t,onOpenChange:a,children:(0,s.jsxs)(er,{children:[(0,s.jsxs)(en,{children:[(0,s.jsx)(ei,{children:"Are you absolutely sure?"}),(0,s.jsxs)(eo,{children:["This action cannot be undone. This will permanently delete the site",(0,s.jsx)("strong",{className:"px-1",children:n}),"and all associated KV data."]})]}),(0,s.jsxs)(el,{children:[(0,s.jsx)(ec,{disabled:i,children:"Cancel"}),(0,s.jsx)(ed,{onClick:d,disabled:i||!n,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:i?"Deleting...":"Yes, Delete Site"})]})]})})}function eb(){let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(""),[d,c]=(0,r.useState)(""),[u,h]=(0,r.useState)(0),[x,g]=(0,r.useState)(!1),[f,m]=(0,r.useState)(!1),[p,v]=(0,r.useState)(!1),[b,j]=(0,r.useState)(!1),[y,k]=(0,r.useState)(new Set),N=()=>{console.log("[page.tsx] handleRefresh called, incrementing refreshCounter"),h(e=>e+1)};return(0,s.jsxs)(l,{children:[(0,s.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,s.jsx)(o,{}),(0,s.jsxs)("main",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[" ",(0,s.jsx)(w,{onSiteSelected:e=>{console.log("Site selected:",e),t(e),n(""),c(""),k(new Set)},refreshCounter:u}),(0,s.jsx)(i.$,{variant:"outline",onClick:()=>m(!0),children:"Create New Site"}),(0,s.jsx)(i.$,{variant:"destructive",onClick:()=>j(!0),disabled:!e,children:"Delete Selected Site"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.$,{onClick:()=>g(!0),disabled:!e,children:"Add New KV Pair"}),(0,s.jsxs)(i.$,{variant:"destructive",onClick:()=>v(!0),disabled:!e||0===y.size,children:["Delete Selected (",y.size,")"]})]})]}),e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[" ",(0,s.jsx)(D.p,{type:"text",placeholder:"Filter keys...",value:a,onChange:e=>n(e.target.value),className:"max-w-xs",disabled:!!d}),(0,s.jsxs)("select",{value:d,onChange:e=>{c(e.target.value),t(null),n("")},className:"border border-gray-300 rounded-md p-2 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:[(0,s.jsx)("option",{value:"",children:"All Statuses"}),(0,s.jsx)("option",{value:"active",children:"Active"}),(0,s.jsx)("option",{value:"inactive",children:"Inactive"}),(0,s.jsx)("option",{value:"pending",children:"Pending"})]})]}),(0,s.jsx)(eu,{selectedSiteId:e,filterText:a,statusFilter:d,refreshCounter:u,onEditSuccess:N,onDeleteSuccess:N,onSelectionChange:e=>{k(e)}})]}),!e&&(0,s.jsx)("p",{className:"text-muted-foreground text-center mt-8",children:"Please select a site to view its KV data."})]})]}),e&&(0,s.jsx)(O,{siteId:e,open:x,onOpenChange:g,onSuccess:N}),(0,s.jsx)(eh,{open:f,onOpenChange:m,onSuccess:N}),(0,s.jsx)(ep,{open:p,onOpenChange:v,siteId:e,keysToDelete:y,onSuccess:()=>{N(),k(new Set)}}),(0,s.jsx)(ev,{open:b,onOpenChange:j,siteId:e,onSuccess:()=>{N(),t(null)}})]})}},285:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>i});var s=a(5155);a(2115);var r=a(9708),n=a(2085),l=a(9434);let i=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:n,asChild:o=!1,...d}=e,c=o?r.DX:"button";return(0,s.jsx)(c,{"data-slot":"button",className:(0,l.cn)(i({variant:a,size:n,className:t})),...d})}},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var s=a(5155);a(2115);var r=a(9434);function n(e){let{className:t,type:a,...n}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},4669:(e,t,a)=>{Promise.resolve().then(a.bind(a,67))},5057:(e,t,a)=>{"use strict";a.d(t,{J:()=>l});var s=a(5155);a(2115);var r=a(968),n=a(9434);function l(e){let{className:t,...a}=e;return(0,s.jsx)(r.b,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},5731:(e,t,a)=>{"use strict";async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=localStorage.getItem("adminToken");if(!a)throw console.error("No auth token found. Redirecting to login should be handled by the caller."),Error("AUTH_TOKEN_MISSING");let s=new Headers(t.headers||{});s.set("Authorization","Bearer ".concat(a)),s.has("Content-Type")||t.body instanceof FormData||s.set("Content-Type","application/json");let r={...t,headers:s};try{let t=await fetch(e,r);if(401===t.status)throw console.error("Unauthorized (401). Token might be invalid or expired."),localStorage.removeItem("adminToken"),Error("UNAUTHORIZED");if(!t.ok){let e=null;try{e=await t.json()}catch(e){}let a=(null==e?void 0:e.error)||t.statusText||"HTTP error ".concat(t.status);throw console.error("API Error: ".concat(a)),Error(a)}let a=t.headers.get("content-type");if(a&&a.includes("application/json"))return await t.json();return null}catch(e){if(console.error("authFetch error:",e),e instanceof Error&&("AUTH_TOKEN_MISSING"===e.message||"UNAUTHORIZED"===e.message))throw e;throw Error("Fetch failed: ".concat(e instanceof Error?e.message:String(e)))}}async function r(e,t){let a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})};try{var s;let e=await fetch("/admin/api/auth/login",a),t=await e.json();if(!e.ok){let a=(null==t?void 0:t.error)||e.statusText||"HTTP error ".concat(e.status);throw console.error("Login API Error: ".concat(a)),Error(a)}if(!t||"string"!=typeof(null==(s=t.data)?void 0:s.token))throw console.error("Login API Error: Invalid response format. Token missing in response.data."),Error("Invalid response format from login API.");return t}catch(e){throw console.error("Login fetch error:",e),e}}a.d(t,{i:()=>r,t:()=>s})},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(2596),r=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[671,174,963,441,684,358],()=>t(4669)),_N_E=e.O()}]);